<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="theme_ninja_quiz.KahootSurveyRunner" owl="1">
        <div class="ninja-quiz-container">
            <t t-if="state.configParamsLoaded">
                <t t-if="state.surveyExists and state.questions.length > 0">
                    <!-- Temporizador -->
                    <div class="progress-timer">
                        <span t-esc="formatText('timer_format', state.timeLeft)"/>
                        <div class="progress-bar">
                            <div class="progress-fill" t-att-style="'width:' + (state.timeLeft / 15 * 100) + '%'"/>
                        </div>
                    </div>

                    <!-- Pregunta -->
                    <h3 class="question-title" t-esc="state.currentQuestion.title"/>

                    <!-- Opciones -->
                    <ul class="options-list fade-in" t-key="state.currentIndex">
                        <t t-foreach="state.currentQuestion.options" t-as="option" t-key="option.id">
                            <li t-att-class="'option-' + option_index">
                                <button
                                    t-on-click="selectOption"
                                    t-att-data-option-id="option.id"
                                    t-att-class="'option-button option-' + option_index + (state.selectedOption === option.id ? ' selected' : '') + (state.currentQuestion.answered ? (option.is_correct ? ' correct' : ' incorrect') : '')"
                                    t-att-disabled="state.isProcessing or state.currentQuestion.answered"
                                >
                                    <span t-esc="option.text"/>
                                </button>
                            </li>
                        </t>
                    </ul>

                    <!-- Retroalimentación -->
                    <t t-if="state.feedbackMessage">
                        <div class="feedback-message" t-att-class="state.currentQuestion.correct ? 'correct' : 'incorrect'">
                            <p t-esc="state.feedbackMessage"/>
                            <t t-if="state.currentQuestion.explanation and state.currentQuestion.answered">
                                <p class="explanation" t-esc="state.currentQuestion.explanation"/>
                            </t>
                        </div>
                    </t>

                    <!-- Navegación -->
                    <div class="navigation-buttons">
                        <button
                            t-on-click="prevQuestion"
                            t-att-disabled="state.currentIndex === 0"
                            class="btn btn-secondary"
                        >Anterior</button>
                        <button
                            t-on-click="nextQuestion"
                            t-att-disabled="state.currentIndex === state.questions.length - 1"
                            class="btn btn-primary"
                        >Siguiente</button>
                    </div>
                </t>
                <t t-else="">
                    <div class="alert alert-danger text-center">
                        <p t-esc="state.feedbackMessage or 'No se encontraron preguntas o la encuesta no existe.'"/>
                    </div>
                </t>
            </t>
            <t t-else="">
                <p class="text-center text-muted">Cargando configuración...</p>
            </t>
        </div>
    </t>
</templates>